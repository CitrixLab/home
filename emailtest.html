<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Email Signup Test</title>
    <link rel="stylesheet" href="https://lexusvp.github.io/citrixlab/assets/css/main.css">
    <link rel="icon" href="images/citrixlab-ico.ico" type="image/x-icon">
    <style>
        /* Center the form */
        .center-box {
            display: flex;
            flex-direction: column; /* Place the form below the text */
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 0.5in); /* Subtract 1 inch from the viewport height */
        }

        /* Style the form container */
        .form-container {
            text-align: center;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-image: url('https://lexusvp.github.io/citrixlab/images/pic05.jpg');
            background-size: cover;
            background-color: rgba(0, 0, 0, 0.9); /* Adjust the background color transparency */
            width: 100%; /* Set the width to 90% of the parent container */
            height: 200%;
			max-width: 600px; /* Add a max-width to limit the box size */
            margin-top: 1in; /* Add 1 inch of space at the top */
        }

        /* Style the banner image */
        #banner {
            background-image: url('https://lexusvp.github.io/citrixlab/images/pic01.jpg');
            background-size: cover;
            background-position: center;
            text-align: center;
            padding: 100px 0;
        }

        /* Style the form inputs */
        #signup-form {
            margin: 20px; /* Add 20px margin to the form */
        }

        #email {
            width: 100%; /* Make the input width 100% of the container */
            max-width: 400px; /* Limit the input width */
            margin: 0 auto; /* Center the input */
            padding: 0px; /* Add padding to the input */
        }

        /* Style the form submit button */
        input[type="submit"] {
            width: 100%; /* Make the button width 100% of the container */
            max-width: 200px; /* Limit the button width */
            margin: 0 auto; /* Center the button */
            padding: 5px; /* Add padding to the button */
        } 
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
</head>
<body>

    <!-- Banner -->
    <section id="banner">
        <ul class="actions special">
        
    <div class="center-box">
    	<a href="emailtest.html"><h2>CitrixLab</h2></a>
        <p></p>
        
        <h5>Welcome to the Future of Innovation: Explore Our Cutting-Edge R&D Lab through various platforms ie. Github, IDX.DEV etc.</h5>
        <div class="form-container">
        
                    <h2>Email Signup Test</h2>
                    
            <p>_________</p>
            
        <blockquote>Dive into a world of professional code testing and implementation with CitrixLab - where innovation knows no bounds.
Join us on a journey through cutting-edge R&D, exploring platforms like Github, IDX.DEV, and more, as we redefine the future of coding excellence..</blockquote>

<h3>#abstract⁷</h3>
            <p>_________</p>

            <form id="signup-form" action="/submit" method="post"> 
                <div class="row gtr-50 gtr-uniform">
                    <div class="col-12">
                        <input type="email" name="email" id="email" placeholder="Email Address" />
                    </div>
                    <div class="col-12">
                        <input type="submit" value="Sign Up!" class="fit" />

                    </div>
                </div>
            </form>
            //<script src="https://lexusvp.github.io/citrixlab/icense/js/submit-button.js"></script>
            
            
            <!-- This div will be used to display the result -->
            <div id="result"></div>
			
            <h1>&copy; Copyright 2023. All rights reserved by. <a href="https://lexusvp.github.io/citrixlab/">CitrixLab</a> | Powered by: <a href="https://msha.ke/citrixlab">#abstract⁷</a></h1> 
        </div>
    </div>
            
        </ul>
    </section>
	
<script>
try
{
// Define a function to shuffle a string
function shuffleString(inputString) {
    const array = inputString.split('');
    let currentIndex = array.length, randomIndex, temporaryValue;

    while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;

        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array.join('');
}

// Define a function to get data from a file and process it
function getDataFromFileAndProcess(url, callback) {
    const controller = new AbortController();
    const signal = controller.signal;

    const fetchPromise = fetch(url, { signal });

    fetchPromise
        .then(response => {
            if (signal.aborted) {
                console.log('Fetch request was aborted.');
                throw new Error('Fetch request was aborted.');
            } else if (!response.ok) {
                throw new Error(`Network response was not ok (status: ${response.status})`);
            } else {
                return response.text();
            }
        })
        .then(data => {
            callback(data);
        })
        .catch(error => {
            if (error.name === 'AbortError') {
                console.log('Fetch request was aborted.');
                throw error;
            } else {
                console.error('Error:', error);
                throw error;
            }
        });
}

// Define a function to decrypt data using CryptoJS
function decryptData(dataToDecrypt, encryptionKey) {
    const decryptedBytes = CryptoJS.AES.decrypt(dataToDecrypt, encryptionKey);
    const decryptedData = decryptedBytes.toString(CryptoJS.enc.Utf8);
    return decryptedData;
}

let fetchedData = `123`;
getDataFromFileAndProcess('https://raw.githubusercontent.com/lexusvp/citrixlab/main/license/js/encryption/cryptograph-auth.txt', function(data){    fetchedData = data;});

let dataToEncrypt=`123`; 
getDataFromFileAndProcess('https://raw.githubusercontent.com/lexusvp/citrixlab/main/license/js/encryption/cryptograph-gmail-api.txt', function(data){    dataToEncrypt = data;});

let jumbledSequence = `123`;
getDataFromFileAndProcess('https://raw.githubusercontent.com/lexusvp/citrixlab/main/license/js/encryption/originalSequenceKey.txt', function(data){    getOSK = data;});

let emailDataNew = `123`;

document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('signup-form');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const email = document.getElementById('email').value;
		
        let emailDataNew = email;
        
        const emailData = {
            email: email
        };
		
        
        const jsonData = JSON.stringify(emailData);

        try {
            const response = await fetch('/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: jsonData
            });

            if (!response.ok) {
                throw new Error(fetchedData);
            }

            resultDiv.innerHTML = `Failed to get fetch: ${fetchedData}`;
        } catch (error) {
            console.error('An error occurred:', error);
            resultDiv.innerHTML = `An error occurred: ${fetchedData}`;
        }

        try {
        
            const encryptionKey = fetchedData; // Use fetched data as the encryption key
            const encryptedData = CryptoJS.AES.encrypt(dataToEncrypt, encryptionKey).toString();

            const q1 = dataToEncrypt.length;
            const z1 = encryptionKey.length - 1;
            const probability1 = AttackerSuccessProbability(q1, z1);

            let jumbledSequence = shuffleString(encryptedData);

            const decryptedData = decryptData(encryptedData, encryptionKey);
            const jumbledSequence2 = shuffleString(decryptedData);

            const jumbledSequence3 = shuffleString(encryptionKey);

            const encryptedData2 = CryptoJS.AES.encrypt(jumbledSequence2, jumbledSequence3).toString();

            const decryptedData2 = decryptData(encryptedData2, jumbledSequence3);
            const jumbledSequence4 = shuffleString(decryptedData2);
            const jumbledSequence5 = shuffleString(jumbledSequence4);
             
            const encryptedEmailData = CryptoJS.AES.encrypt(emailDataNew, encryptionKey).toString();
            const jumbledSequence6 = shuffleString(encryptedEmailData);
            
            resultDiv.innerHTML = `Probability (q=${q1}, z=${z1}): ${probability1} <br>Email Address Encrypted Data: <br>${jumbledSequence6}<br>Encrypted Data: <br>${encryptedData}
            <br>2nd Layer Encrypted Data: <br>${jumbledSequence} <br> Decrypted Data: <br>${decryptedData2} 
            <br> 2nd Layer Decrypted Data: <br>${jumbledSequence5} <br>Encryption Keys:<br>${encryptionKey} 
            &  ${decryptedData}<br>2nd Layer Encryption Key:<br>${jumbledSequence3}`;
            
        } catch (error) {
            resultDiv.innerHTML = `An error occurred: ${error.message}`;
        }
    });
});

// Function to calculate Attacker Success Probability
function AttackerSuccessProbability(q, z) {
    let p = 1.0 - q;
    let lambda = z * (q / p);
    let sum = 1.0;

    for (let k = 0; k <= z; k++) {
        let poisson = Math.exp(-lambda);

        for (let i = 1; i <= k; i++) {
            poisson *= lambda / i;
        }

        sum -= poisson * (1 - Math.pow(q / p, z - k));
    }

    return sum;
}

} catch (error) {resultDiv.innerHTML = `An error occurred: ${error}`;}
    </script> 
</body>
</html>
